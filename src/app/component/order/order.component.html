<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="page-title">إدارة الطلبات</h2>
    <span class="badge bg-primary-soft text-primary">{{orders.length}} طلب إجمالي</span>
  </div>

  <div class="card table-card d-none d-lg-block">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead>
          <tr>
            <th>#ID</th>
            <th>المستخدم</th>
            <th>العناصر</th>
            <th>الإجمالي</th>
            <th>الحالة</th>
            <th>التاريخ</th>
            <th class="text-center">إجراءات</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let order of orders">
            <td class="text-truncate" style="max-width: 100px;">
              <span class="fw-bold text-dark">#{{ order._id.slice(-6) }}</span>
            </td>
            <td>
              <div class="d-flex flex-column">
                <span class="fw-medium">{{ order['user']?.email || 'N/A' }}</span>
              </div>
            </td>
            <td><span class="item-count">{{ order.items.length }} منتجات</span></td>
            <td class="fw-bold text-dark">{{ order.total | currency:'EGP':'symbol' }}</td>
            <td>
              <span class="status-badge" [ngClass]="order.status">
                {{ order.status | titlecase }}
              </span>
            </td>
            <td class="text-muted small">{{ order['createdAt'] | date:'shortDate' }}</td>
            <td>
              <div class="d-flex justify-content-center gap-2">
                <button class="action-btn view" (click)="viewOrder(order)" title="تفاصيل"><i class="bi bi-eye"></i></button>
                <button class="action-btn process" (click)="updateStatus(order, 'processing')" [disabled]="order.status!=='pending'"><i class="bi bi-gear"></i></button>
                <button class="action-btn ship" (click)="updateStatus(order, 'shipped')" [disabled]="order.status!=='processing'"><i class="bi bi-truck"></i></button>
                <button class="action-btn deliver" (click)="updateStatus(order, 'delivered')" [disabled]="order.status!=='shipped'"><i class="bi bi-check-circle"></i></button>
                <button class="action-btn cancel" (click)="updateStatus(order, 'cancelled')" [disabled]="order.status==='delivered' || order.status==='cancelled'"><i class="bi bi-x-circle"></i></button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="d-lg-none">
    <div class="order-mobile-card" *ngFor="let order of orders">
      <div class="card-header-mobile">
        <span class="fw-bold">#{{ order._id.slice(-6) }}</span>
        <span class="status-badge" [ngClass]="order.status">{{ order.status }}</span>
      </div>
      <div class="card-body-mobile">
        <p><i class="bi bi-envelope me-2"></i> {{ order['user']?.email }}</p>
        <p><i class="bi bi-cart me-2"></i> {{ order.items.length }} منتجات</p>
        <p class="price-mobile">{{ order.total | currency:'EGP':'symbol' }}</p>
      </div>
      <div class="card-actions-mobile">
        <button class="btn btn-sm btn-outline-primary" (click)="viewOrder(order)">التفاصيل</button>
        <div class="dropdown">
          <button class="btn btn-sm btn-dark dropdown-toggle" type="button" data-bs-toggle="dropdown">تغيير الحالة</button>
          <ul class="dropdown-menu">
             <li><a class="dropdown-item" (click)="updateStatus(order, 'processing')">معالجة</a></li>
             <li><a class="dropdown-item" (click)="updateStatus(order, 'shipped')">شحن</a></li>
             <li><a class="dropdown-item" (click)="updateStatus(order, 'delivered')">تم التسليم</a></li>
             <li><hr class="dropdown-divider"></li>
             <li><a class="dropdown-item text-danger" (click)="updateStatus(order, 'cancelled')">إلغاء</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="modal-body p-4" *ngIf="selectedOrder">
  <div class="row g-4">
    <div class="col-md-6">
      <h6 class="text-muted small text-uppercase mb-3">بيانات العميل</h6>
      <div class="d-flex align-items-center gap-3 mb-2">
        <div class="avatar-placeholder">{{selectedOrder['user']?.email?.[0].toUpperCase()}}</div>
        <div>
          <p class="mb-0 fw-bold">{{ selectedOrder['user']?.email }}</p>
          <p class="mb-0 small text-muted">ID: {{selectedOrder._id}}</p>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <h6 class="text-muted small text-uppercase mb-3">ملخص الحالة</h6>
      <span class="status-badge" [ngClass]="selectedOrder.status">{{selectedOrder.status}}</span>
      <p class="mt-2 fw-bold text-primary fs-5">{{ selectedOrder.total | currency:'EGP':'symbol' }}</p>
    </div>
    
    <div class="col-12">
      <h6 class="text-muted small text-uppercase mb-3">المنتجات المطلوبة</h6>
      <div class="table-responsive bg-light rounded-3 p-2">
        <table class="table table-sm mb-0">
          </table>
      </div>
    </div>
  </div>
</div>
